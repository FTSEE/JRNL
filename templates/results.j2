<!DOCTYPE html>
<head>
  <script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>
</head>
<body>
  <div>
    <h1>
      Here are your Results:
    </h1>
    <p>response:<br>{{ response }}</p>
    <p id="moodID"> analyzing... </p>
    <p id="confidenceID"> analyzing... </p>
    <p id="reflectionID"> analyzing... </p>
    <div id="pieChart"></div>
  </div>
  <script>
    //loading page for async functions
    //creating a response string to send back for the fetch
    const response = '{{ response | escape | tojson | safe}}';

    window.onload = async () => {
      const res = await fetch('/analyze', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({response: response})
      });

      const data = await res.json();
      console.log(data);

      document.getElementById("moodID").innerText = "Your detected mood is: " + data.mood;
      document.getElementById("confidenceID").innerText = "Our confidence of your mood is: " + data.confidence;
      document.getElementById("reflectionID").innerText = "Our AI has some Comments or Questions (Beta): " + data.reflection;

      //plotting graphic
      const emotionData = data.emotionDist;
      const labels = Object.keys(emotionData).slice(1);
      const values = Object.values(emotionData).slice(1);
      
      var chartData = [{
        labels: labels,
        values: values,
        type: 'pie'
      }];

      var layout = {
      height: 400,
      width: 500
      };

      Plotly.newPlot('pieChart', chartData, layout);
    }
  </script>
</body>
